// Data Object
var data = {
    chatinit: {
        title: ["Hello <span class='emoji'> &#128075;</span>", "I am Mr.GEMINI", "Welcome to SKSVMACET FAMILY", "How can I help you?"],
        options: ["About_College <span class='emoji'>&#128210;</span>", "Available College Branches <span class='emoji'>&#128187;</span>", "Eligibility <span class='emoji'>&#128188;</span>", "Admission Process <span class='emoji'>&#9997;</span>", "Contact_Info <span class='emoji'>&#128222;</span>", "Other <span class='emoji'>&#129535;</span>"]
    },
    about_College: {
        title:["Please select category"],
        options:['Smt Kamala and Sri Venkappa M. Agadi College of Engineering & Technology (SKSVMACET), established in 2003, is a private institution in Karnataka. It offers full-time undergraduate B.E./B.Tech courses across various disciplines, with an intake capacity of 360 students. The college has a solid reputation for its AICTE-approved engineering programs and experienced faculty. Popular branches include Computer Science, Electronics, Information Science, and Mechanical Engineering. Admissions are conducted via KCET and COMEDK UGET exams. The college s median salary package for placements is around ₹2 LPA, with top recruiters like Infosys, TCS, and IBM.','Contact_Info','Other'],
        url : {
            
        }
    },
    contact_info: {
        title:["Here is Collage Contact Information"],
        options:["Collage_Location","Email Us","Call Now","Other"],
        url : {
            
        }
    },
    email:{
        title:["Here is Collage Email to Contact us"],
        options:["info@agadiengcollege.com","principal@agadiengcollege.com"],
        url : {
            more:"https://agadiengcollege.com/contact-us/",
            link:["https://agadiengcollege.com/contact-us/","https://agadiengcollege.com/contact-us/","https://agadiengcollege.com/contact-us/"]
        }
    },
    call:{
        title:["Here is Collage Contact Information"],
        options:["91 94481 20344"],
        url : {
            more:"https://agadiengcollege.com/contact-us/",
            link:["https://agadiengcollege.com/contact-us/","https://agadiengcollege.com/contact-us/","https://agadiengcollege.com/contact-us/"]
        }
    },
    collage_location: {
        title:["Collage Location"],
        options:["SH 6, Savnur Road, Lakshmeshar 582116.Dt: Gadag, State: Karnataka, INDIA","Location in Map"],
        url : {
            more:"https://www.google.com/maps/place/Smt+Kamala+And+Sri+Venkappa+M.+Agadi+College+of+Engineering+%26+Technology/@15.0995632,75.4547949,15z/data=!4m6!3m5!1s0x3bb9109d674d38e3:0x683354f6190efee5!8m2!3d15.0995632!4d75.4547949!16s%2Fg%2F1hf00zqcy?entry=ttu&g_ep=EgoyMDI0MTEwNi4wIKXMDSoASAFQAw%3D%3D",
            link:["https://www.google.com/maps/place/Smt+Kamala+And+Sri+Venkappa+M.+Agadi+College+of+Engineering+%26+Technology/@15.0995632,75.4547949,15z/data=!4m6!3m5!1s0x3bb9109d674d38e3:0x683354f6190efee5!8m2!3d15.0995632!4d75.4547949!16s%2Fg%2F1hf00zqcy?entry=ttu&g_ep=EgoyMDI0MTEwNi4wIKXMDSoASAFQAw%3D%3D","https://www.google.com/maps/place/Smt+Kamala+And+Sri+Venkappa+M.+Agadi+College+of+Engineering+%26+Technology/@15.0995632,75.4547949,15z/data=!4m6!3m5!1s0x3bb9109d674d38e3:0x683354f6190efee5!8m2!3d15.0995632!4d75.4547949!16s%2Fg%2F1hf00zqcy?entry=ttu&g_ep=EgoyMDI0MTEwNi4wIKXMDSoASAFQAw%3D%3D"]
            
        }
    },
    available: {
        title:["Here is Available Branches"],
        options:['Civil Engineering','Computer Science Engineering','Electrical & Electronics Engineering','Electronics and Communication Engineering','Information Science and Engineering','Mechanical Engineering','Other'],
        url : {
            
        }
    },
    civil: {
        title:["Civil Engineering"],
        options:["Department has sufficient class rooms and most of them are equipped with multimedia projectors. Department also has its own Seminar Hall, 8 well equipped laboratories"],
        url : {
            more:"https://agadiengcollege.com/civil-engineering/",
            link:["https://agadiengcollege.com/civil-engineering/"]
        }
    },

    computer: {
        title:["Computer Science Engineering"],
        options:["The Department of CSE is one of the most dynamic branches in the college and is always trying to inculcate a strong foundation in the field of Computer Science & Engineering along with professional ethics and human values, in the lifestyle of each student. The main pillars of our department are our confident, dedicated, and hardworking faculty and technical staff, with an average experience of 12+ years"],
        url : {
            more:"https://agadiengcollege.com/computer-science-engineering/",
            link:["https://agadiengcollege.com/computer-science-engineering/"]
        }
    },
    electrical: {
        title:["Electrical & Electronics Engineering"],
        options:["The department of Electrical and Electronics Engineering was established in the year of 2010-11 with intake of 60 students. The department is certified with Management System as per ISO 9001:2015."],
        url : {
            more:"https://agadiengcollege.com/electrical-electronics-engineering/",
            link:["https://agadiengcollege.com/electrical-electronics-engineering/"]
        }
    },
    electronics: {
        title:["Electronics & Communication Engineering"],
        options:['The graduates of the Electronics & Communication Stream have been selected by some of the world’s leading corporations & as well as by most of the leading Indian counter parts. We hope that we will continue to deliver our best to serve the society and mankind.'],
        url : {
            more:"https://agadiengcollege.com/electronics-communication-engineering/",
            link:["https://agadiengcollege.com/electronics-communication-engineering/"]
        }
    },
    information: {
        title:["Information Science & Engineering Engineering"],
        options:["Welcome to the Information Science & Engineering Department.As we navigate through the current academic year, I would like to take a moment to update you on the latest developments and initiatives within the Information Science & Engineering Department. We are committed to maintain high academic standards and foster an environment that promotes excellence in teaching and learning Process. Our faculty members continue to engage in research, professional development, and innovative teaching methods to ensure our students receive a top-notch education."],
        url : {
            more:"https://agadiengcollege.com/information-science-engineering/",
            link:["https://agadiengcollege.com/information-science-engineering/"]
        }
    },

    mechanical: {
        title:["Mechanical Engineering"],
        options:["The department boasts well-qualified and dedicated faculty members. The main objective of the department is to encourage students both personally and professionally to achieve successful careers in prominent industries. Faculty members have excellent academic credentials and are highly regarded. For the overall development of students, we have formulated a Mechanical Engineering Students' association, i.e., TORQUE. "],
        url : {
            more:"https://agadiengcollege.com/mechanical-engineering/",
            link:["https://agadiengcollege.com/mechanical-engineering/"]
        }
    },

    other: {
        title: ["Here are some more options for you"],
        options: ["Transportaion Service","CET CODE/COMEDK CODE E ","Collage_Location","Hostel Facilities"],
        url: {
        }
    },
    transportaion: {
        title:["Here is the information of Transportation"],
        options:["Hubbli to Collage","Gadag to Collage","Local to Collage","Contact Information"],
        url : {
            
        }
    },
    
    hubbli: {
        title:["Here is the information of Hubbli-Collage Transportation"],
        options:["Hubli to College (Dept: 07:30 am from Old Bus stand), Evening 05:40 pm from College to Hubli."],
        url : {
            more:"https://agadiengcollege.com/transportation/",
            link:["https://agadiengcollege.com/transportation/"]
        }
    },
    gadag: {
        title:["Here is the information of Gadag-Collage Transportation"],
        options:[" Gadag to College (Dept: 07:40 am from Saibaba Temple), Evening 05:40 pm from College to Gadag."],
        url : {
            more:"https://agadiengcollege.com/transportation/",
            link:["https://agadiengcollege.com/transportation/"]
        }
    },
    local: {
        title:["Here is the information of Local-Collage Transportation"],
        options:["Route No 1 : Lakshmeshwar Bus stand to College            Route No 2: Lakshmeshwar Pampa Circle to College"],
        url : {
            more:"https://agadiengcollege.com/transportation/",
            link:["https://agadiengcollege.com/transportation/"]
        }
    },
    contact: {
        title:["Here is the Contact Information"],
        options:["Prof. S M Patil (Bus Coordinator) 9986540615","Mr. Malleshappa (Driver) 9916367059","Mr. Manjunath Arali (Driver)  9380004863","Mr. Shanmukh (Driver)  9164256593","Mr. Somanna (Driver) 9916765598"],
        url : {
            more:"#",
            link:["#","#","#","#","#","#","#",]
        }},
    cet: {
        title:["Here is the information about CET CODE/COMEDK CODE E"],
        options:['CET CODE E – 134 ','COMEDK CODE E – 128'],
        url : {
           
        }
    },
    eligibility: {
        title:["Here is information about Elgiblity"],
        options:['The candidates shall have passed PUC-II or any other examination recognised by the University with an aggregate of 45 % marks in Physics, Mathematics, and any one of the following subjects. Chemistry / Biology / Biotechnology / Electronics / Computer Science / Information Science.','Admission is given to candidates who have written the Common Entrance Test (CET)/COMEDK conducted by the Government of Karnataka. The candidate must ensure his/her eligibility before submitting the application form'],
        url : {
            more:"https://agadiengcollege.com/eligibility/",
            link:["https://agadiengcollege.com/eligibility/"]
        }
    },
    admission: {
        title:["Here is information about Admission Process"],
        options:["01. Interaction with Admissions Coordinator.","02. Document Verification.",'03. Admission Order Download.','04. Filling out the Admission Form.','05. Fee payment to KEA.','06. Report to College.','07. Finalising the admissions.'],
        url : {
         
        }
    },
    hostel: {
        title:["Here is the information about Hostel Facilities"],
        options:['About_Hostel','Facilities','Hostel_Fees','Food_Timings','Rules & Regulations','Contact_Information'],
        url : {
           
        }
    },
    about_hostel: {
        title:["Here is the information about Hostel Facilities"],
        options:['Smt. Kamala & Sri Venkappa M. Agadi College of Engineering & Technology has a well-equipped hostel facility for both boys and girls. The building is an elegantly designed three-storied hostel building inside the college premise to ensure that the students dwell in a healthy environment that helps them to grow and learn without any obstacles. All the rooms have been designed to provide adequate moving space as well as ample air and light.It’s a second home that ensures that students live out their college lives in a healthy, safe, and conducive environment.','hostel'],
        url : {
           
        }
    },
    facilities: {
        title:["Here is the information about Hostel Facilities"],
      
        options: ["Each room has a shared tube light, fan, and basic furnishings including a cot, chair, table, and cupboard for each student","Wi-Fi enabled building.","The hostel includes separate arrangements for RO drinking water facilities on each level with on-site RO plants.","A tidy, well-maintained kitchen that serves students preferred vegetarian meals in a dining hall that has a TV.","Solar panels provide hot water that is available around the clock.","The hostel has CCTV cameras to maintain a close eye on things and a security officer on duty around-the-clock.","24 hours Power availability.","Boys and girls can use the gym and participate in sports (both indoor and outdoor).",'hostel'],
       
        url : {
            more:"https://agadiengcollege.com/hostel/",
            link:["https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/"]
        
        }
    },
      hostel_fees: {
        title:["Here is the information about Hostel Fees"],
        options: ["Hostel Rent – Rs. 28,000/- per year.","Hostel Deposit – Rs. 5,000/- (Refundable) "," Tentative Mess Advance amount – Rs. 24,000/-","hostel"],
        url: {
            more:"https://agadiengcollege.com/hostel/",
            link:["https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/"]
        }
    },
    food_timings: {
        title:["Here is the information about Hostel Food Timing"],
        options: ["Breakfast – 7.00 am to 9.00 am","Lunch – 12.30 pm to 2.00 pm ","Evening Tea/Snacks – 5.30 pm to 6.30 pm","Dinner – 7.30 pm to 9.00 pm ","hostel"],
        url: {
            more:"https://agadiengcollege.com/hostel/",
            link:["https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/"]
        }
    },
    rules: {
        title: ["Here is the information about Hostel Rules & Regulations"],
        options: ["The student should not paste any posters or paintings on the walls of in and outside residential premises", "The entrance of outsiders in the residential accommodation will be restricted and entry and/or stay of parents/guardian or any other visitor (if authorized) will be subject to the permission of warden and other concerned authorities of the College", "Students having complaints regarding mess should report to the Warden, Principal and A/O", "But they are not allowed to indulge in accumulating the mess or strike", "Students should be present in their respective rooms when the attendance is taken at night", "Students are not to damage any property inside the residential premises", "Students with genuine reason are allowed to go out even after 7 p.m. to 8 p.m. with the warden’s permission","hostel"],
        url: {
            more:"https://agadiengcollege.com/hostel/",
            link:["https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/"]
        }
    },
    contact_information: {
        title: ["Here is the information about Hostel Contact_Information"],
        options: ["Boy’s Hostel Warden – Dr. R. M. Patil: +91-83800 12392,","Boy’s Hostel Superintendent – Mr. Shivaputrappa Barker: +91-97439 33211,","Girl’s Hostel Assistant Warden – Ms. Shridevi Hediyal: +91-82960 59199","Girl’s Hostel Superintendent – Mrs. Ratna Matapati: +91-74064 28439,"],
        url: {
            more:"https://agadiengcollege.com/hostel/",
            link:["https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/","https://agadiengcollege.com/hostel/"]
        }
    },
    // Additional data for other options...
};

// Track whether the user has been welcomed already
let hasWelcomedUser = false;
let historyStack = []; // To track chat history
let cbot = document.getElementById("chat-box");

document.getElementById("init").addEventListener("click", showChatBot);

function showChatBot() {
    document.getElementById('test').style.display = 'block';
    document.getElementById('init').style.display = 'none';
    initChat();
}

function initChat() {
    hasWelcomedUser = false; // Reset the welcome flag when starting a new chat
    historyStack = []; // Clear the chat history stack
    cbot.innerHTML = ''; // Clear chat window
    showWelcomeMessage(); // Show the welcome message only once at the beginning
}

function showWelcomeMessage() {
    if (!hasWelcomedUser) {
        // Only show the welcome message if it hasn't been shown yet
        showMessage(data.chatinit.title, true); // Show the welcome message
        setTimeout(() => showOptions(data.chatinit.options), 1500); // Show options after the welcome message
        hasWelcomedUser = true; // Mark the user as welcomed
    }
}

function showMessage(titleArray, isInitial = false) {
    titleArray.forEach((title, i) => {
        setTimeout(() => {
            const elm = document.createElement("p");
            elm.innerHTML = title;
            elm.className = "msg";
            cbot.appendChild(elm);
            handleScroll();

            // Show options after the last welcome message
            if (isInitial && i === titleArray.length - 1) {
                setTimeout(() => showOptions(data.chatinit.options), 500); // Delay options by 500ms
            }
        }, i * 500); // 500ms delay between each message
    });
}

function showOptions(options) {
    // Clear the previous options (if any) before showing new ones
    clearOptions();

    options.forEach(option => {
        const opt = document.createElement("span");
        opt.className = "opt";
        opt.innerHTML = `<div>${option}</div>`;
        opt.addEventListener("click", handleOpt);
        cbot.appendChild(opt);
    });
    addBackButton(); // Add back button to navigate through options
    handleScroll();
}

function handleOpt() {
    const optionText = this.innerText.split(" ")[0].toLowerCase();
    const selectionData = data[optionText];
    if (!selectionData) return;

    // Push the current view to history stack to allow navigation back
    historyStack.push({ title: selectionData.title, options: selectionData.options });

    // Clear the options and show the next set of messages
    clearOptions();
    showMessage(selectionData.title);

    // Show links if URLs exist, otherwise show more options
    if (selectionData.url && selectionData.url.link) {
        showLinks(selectionData.options, selectionData.url);
    } else {
        showOptions(selectionData.options);
    }
}

function showLinks(options, url) {
    options.forEach((option, i) => {
        const link = document.createElement("span");
        link.className = "opt";
        link.innerHTML = `<a class="m-link" href="${url.link[i]}" target="_blank">${option}</a>`;
        cbot.appendChild(link);
    });
    addBackButton();
    handleScroll();
}

function addBackButton() {
    const backBtn = document.createElement("span");
    backBtn.className = "opt back-btn";
    backBtn.innerText = "Back";
    backBtn.addEventListener("click", handleBack); // Add click event listener for Back button
    cbot.appendChild(backBtn);
}

function handleBack() {
    if (historyStack.length > 1) { // Check if there's a previous state
        historyStack.pop(); // Remove the current state
        const prev = historyStack[historyStack.length - 1]; // Get previous state
        clearOptions(); // Clear current options

        // Check if we are at the initial options (first options), but not the welcome message
        if (prev.title === data.chatinit.title) {
            // If the previous state was the initial state (first options), show the first options
            showOptions(data.chatinit.options);
        } else {
            // Otherwise, show the previous message and options
            showMessage(prev.title);
            showOptions(prev.options);
        }
    } else {
        // If the history stack has only one item, do nothing (avoid restart)
        showOptions(data.chatinit.options); // Show first options again
    }
}

function clearOptions() {
    document.querySelectorAll(".opt").forEach(el => el.remove()); // Remove current options
}

function handleScroll() {
    const elem = document.getElementById('chat-box');
    elem.scrollTop = elem.scrollHeight; // Scroll to the bottom of the chat window
}
